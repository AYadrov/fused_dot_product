# Fused Dot Product
Python model of the fused dot product described by Kaul et al. (2019). The project builds a strongly typed AST for fixed-point and floating-point operations, and uses it to compare a conventional BF16 dot product against an optimized, fused implementation.

## What's here
- `fused_dot_product/ast/AST.py` – Node definitions with static/dynamic type checking, constant folding, and tree printing.
- `fused_dot_product/numtypes/` – Runtime and static types for `Q`/`UQ` fixed point, `BF16`, and `Float32`, plus random value generators.
- `designs/conventional.py` and `designs/optimized.py` – Two BF16x4 to FP32 dot-product designs that can be evaluated and inspected as ASTs.
- `fused_dot_product/utils/composites.py` – Common composites and primitives.
- `docs/operators.md` – Tables of all basic operators, fixed-point primitives, and composites.

## Quick start
1) Ensure Python 3.10+ is available (CI uses 3.13).  
2) Install deps:
```
make install
```
3) Run the sample check (compares optimized vs conventional on random BF16 vectors):
```
python main.py --seed 0
```
## Testing
```
make unit-tests
```

## Inspecting the AST
Both designs can print their internal trees; for example, to see the conventional design structure, run:
```
a = [Var(f"a_{i}", BFloat16T()) for i in range(4)]
b = [Var(f"b_{i}", BFloat16T()) for i in range(4)]
Conventional(*a, *b).print_tree(depth=1)
```
Which outputs a high-level tree:
```
└── Float<32>: Conventional [Composite]
    └── Impl:
        └── Float<32>: encode_Float32 [Primitive]
            ├── Q<5,28>: q_add [Primitive]
            │   ├── Q<4,28>: q_add [Primitive]
            │   │   ├── Q<3,28>: q_add_sign [Primitive]
            │   │   │   ├── Q<3,28>: uq_to_q [Primitive]
            │   │   │   │   └── UQ<2,28>: uq_rshift [Primitive]
            │   │   │   │       ├── UQ<2,28>: uq_resize [Primitive]
            │   │   │   │       │   └── UQ<2,14>: uq_mul [Primitive]
            │   │   │   │       │       ├── UQ<1,7>: mantissa_add_implicit_bit [Composite]
            │   │   │   │       │       │   └── UQ<7,0>: Tuple_get_item_1 [Op]
            │   │   │   │       │       │       └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │   │   │       │       │           └── BFloat<16>: a_0 [Var]
            │   │   │   │       │       └── UQ<1,7>: mantissa_add_implicit_bit [Composite]
            │   │   │   │       │           └── UQ<7,0>: Tuple_get_item_1 [Op]
            │   │   │   │       │               └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │   │   │       │                   └── BFloat<16>: b_0 [Var]
            │   │   │   │       └── UQ<10,0>: uq_sub [Primitive]
            │   │   │   │           ├── UQ<9,0>: uq_max [Primitive]
            │   │   │   │           │   ├── UQ<9,0>: uq_max [Primitive]
            │   │   │   │           │   │   ├── UQ<9,0>: uq_add [Primitive]
            │   │   │   │           │   │   │   ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │   │   │           │   │   │   │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │   │   │           │   │   │   │       └── BFloat<16>: a_0 [Var]
            │   │   │   │           │   │   │   └── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │   │   │           │   │   │       └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │   │   │           │   │   │           └── BFloat<16>: b_0 [Var]
            │   │   │   │           │   │   └── UQ<9,0>: uq_add [Primitive]
            │   │   │   │           │   │       ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │   │   │           │   │       │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │   │   │           │   │       │       └── BFloat<16>: a_1 [Var]
            │   │   │   │           │   │       └── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │   │   │           │   │           └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │   │   │           │   │               └── BFloat<16>: b_1 [Var]
            │   │   │   │           │   └── UQ<9,0>: uq_max [Primitive]
            │   │   │   │           │       ├── UQ<9,0>: uq_add [Primitive]
            │   │   │   │           │       │   ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │   │   │           │       │   │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │   │   │           │       │   │       └── BFloat<16>: a_2 [Var]
            │   │   │   │           │       │   └── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │   │   │           │       │       └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │   │   │           │       │           └── BFloat<16>: b_2 [Var]
            │   │   │   │           │       └── UQ<9,0>: uq_add [Primitive]
            │   │   │   │           │           ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │   │   │           │           │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │   │   │           │           │       └── BFloat<16>: a_3 [Var]
            │   │   │   │           │           └── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │   │   │           │               └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │   │   │           │                   └── BFloat<16>: b_3 [Var]
            │   │   │   │           └── UQ<9,0>: uq_add [Primitive]
            │   │   │   │               ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │   │   │               │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │   │   │               │       └── BFloat<16>: a_0 [Var]
            │   │   │   │               └── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │   │   │                   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │   │   │                       └── BFloat<16>: b_0 [Var]
            │   │   │   └── UQ<1,0>: sign_xor [Primitive]
            │   │   │       ├── UQ<1,0>: Tuple_get_item_0 [Op]
            │   │   │       │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │   │       │       └── BFloat<16>: a_0 [Var]
            │   │   │       └── UQ<1,0>: Tuple_get_item_0 [Op]
            │   │   │           └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │   │               └── BFloat<16>: b_0 [Var]
            │   │   └── Q<3,28>: q_add_sign [Primitive]
            │   │       ├── Q<3,28>: uq_to_q [Primitive]
            │   │       │   └── UQ<2,28>: uq_rshift [Primitive]
            │   │       │       ├── UQ<2,28>: uq_resize [Primitive]
            │   │       │       │   └── UQ<2,14>: uq_mul [Primitive]
            │   │       │       │       ├── UQ<1,7>: mantissa_add_implicit_bit [Composite]
            │   │       │       │       │   └── UQ<7,0>: Tuple_get_item_1 [Op]
            │   │       │       │       │       └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │       │       │       │           └── BFloat<16>: a_1 [Var]
            │   │       │       │       └── UQ<1,7>: mantissa_add_implicit_bit [Composite]
            │   │       │       │           └── UQ<7,0>: Tuple_get_item_1 [Op]
            │   │       │       │               └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │       │       │                   └── BFloat<16>: b_1 [Var]
            │   │       │       └── UQ<10,0>: uq_sub [Primitive]
            │   │       │           ├── UQ<9,0>: uq_max [Primitive]
            │   │       │           │   ├── UQ<9,0>: uq_max [Primitive]
            │   │       │           │   │   ├── UQ<9,0>: uq_add [Primitive]
            │   │       │           │   │   │   ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │       │           │   │   │   │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │       │           │   │   │   │       └── BFloat<16>: a_0 [Var]
            │   │       │           │   │   │   └── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │       │           │   │   │       └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │       │           │   │   │           └── BFloat<16>: b_0 [Var]
            │   │       │           │   │   └── UQ<9,0>: uq_add [Primitive]
            │   │       │           │   │       ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │       │           │   │       │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │       │           │   │       │       └── BFloat<16>: a_1 [Var]
            │   │       │           │   │       └── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │       │           │   │           └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │       │           │   │               └── BFloat<16>: b_1 [Var]
            │   │       │           │   └── UQ<9,0>: uq_max [Primitive]
            │   │       │           │       ├── UQ<9,0>: uq_add [Primitive]
            │   │       │           │       │   ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │       │           │       │   │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │       │           │       │   │       └── BFloat<16>: a_2 [Var]
            │   │       │           │       │   └── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │       │           │       │       └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │       │           │       │           └── BFloat<16>: b_2 [Var]
            │   │       │           │       └── UQ<9,0>: uq_add [Primitive]
            │   │       │           │           ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │       │           │           │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │       │           │           │       └── BFloat<16>: a_3 [Var]
            │   │       │           │           └── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │       │           │               └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │       │           │                   └── BFloat<16>: b_3 [Var]
            │   │       │           └── UQ<9,0>: uq_add [Primitive]
            │   │       │               ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │       │               │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │       │               │       └── BFloat<16>: a_1 [Var]
            │   │       │               └── UQ<8,0>: Tuple_get_item_2 [Op]
            │   │       │                   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │       │                       └── BFloat<16>: b_1 [Var]
            │   │       └── UQ<1,0>: sign_xor [Primitive]
            │   │           ├── UQ<1,0>: Tuple_get_item_0 [Op]
            │   │           │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │           │       └── BFloat<16>: a_1 [Var]
            │   │           └── UQ<1,0>: Tuple_get_item_0 [Op]
            │   │               └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │   │                   └── BFloat<16>: b_1 [Var]
            │   └── Q<4,28>: q_add [Primitive]
            │       ├── Q<3,28>: q_add_sign [Primitive]
            │       │   ├── Q<3,28>: uq_to_q [Primitive]
            │       │   │   └── UQ<2,28>: uq_rshift [Primitive]
            │       │   │       ├── UQ<2,28>: uq_resize [Primitive]
            │       │   │       │   └── UQ<2,14>: uq_mul [Primitive]
            │       │   │       │       ├── UQ<1,7>: mantissa_add_implicit_bit [Composite]
            │       │   │       │       │   └── UQ<7,0>: Tuple_get_item_1 [Op]
            │       │   │       │       │       └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │       │   │       │       │           └── BFloat<16>: a_2 [Var]
            │       │   │       │       └── UQ<1,7>: mantissa_add_implicit_bit [Composite]
            │       │   │       │           └── UQ<7,0>: Tuple_get_item_1 [Op]
            │       │   │       │               └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │       │   │       │                   └── BFloat<16>: b_2 [Var]
            │       │   │       └── UQ<10,0>: uq_sub [Primitive]
            │       │   │           ├── UQ<9,0>: uq_max [Primitive]
            │       │   │           │   ├── UQ<9,0>: uq_max [Primitive]
            │       │   │           │   │   ├── UQ<9,0>: uq_add [Primitive]
            │       │   │           │   │   │   ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │       │   │           │   │   │   │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │       │   │           │   │   │   │       └── BFloat<16>: a_0 [Var]
            │       │   │           │   │   │   └── UQ<8,0>: Tuple_get_item_2 [Op]
            │       │   │           │   │   │       └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │       │   │           │   │   │           └── BFloat<16>: b_0 [Var]
            │       │   │           │   │   └── UQ<9,0>: uq_add [Primitive]
            │       │   │           │   │       ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │       │   │           │   │       │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │       │   │           │   │       │       └── BFloat<16>: a_1 [Var]
            │       │   │           │   │       └── UQ<8,0>: Tuple_get_item_2 [Op]
            │       │   │           │   │           └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │       │   │           │   │               └── BFloat<16>: b_1 [Var]
            │       │   │           │   └── UQ<9,0>: uq_max [Primitive]
            │       │   │           │       ├── UQ<9,0>: uq_add [Primitive]
            │       │   │           │       │   ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │       │   │           │       │   │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │       │   │           │       │   │       └── BFloat<16>: a_2 [Var]
            │       │   │           │       │   └── UQ<8,0>: Tuple_get_item_2 [Op]
            │       │   │           │       │       └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │       │   │           │       │           └── BFloat<16>: b_2 [Var]
            │       │   │           │       └── UQ<9,0>: uq_add [Primitive]
            │       │   │           │           ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │       │   │           │           │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │       │   │           │           │       └── BFloat<16>: a_3 [Var]
            │       │   │           │           └── UQ<8,0>: Tuple_get_item_2 [Op]
            │       │   │           │               └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │       │   │           │                   └── BFloat<16>: b_3 [Var]
            │       │   │           └── UQ<9,0>: uq_add [Primitive]
            │       │   │               ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │       │   │               │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │       │   │               │       └── BFloat<16>: a_2 [Var]
            │       │   │               └── UQ<8,0>: Tuple_get_item_2 [Op]
            │       │   │                   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │       │   │                       └── BFloat<16>: b_2 [Var]
            │       │   └── UQ<1,0>: sign_xor [Primitive]
            │       │       ├── UQ<1,0>: Tuple_get_item_0 [Op]
            │       │       │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │       │       │       └── BFloat<16>: a_2 [Var]
            │       │       └── UQ<1,0>: Tuple_get_item_0 [Op]
            │       │           └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │       │               └── BFloat<16>: b_2 [Var]
            │       └── Q<3,28>: q_add_sign [Primitive]
            │           ├── Q<3,28>: uq_to_q [Primitive]
            │           │   └── UQ<2,28>: uq_rshift [Primitive]
            │           │       ├── UQ<2,28>: uq_resize [Primitive]
            │           │       │   └── UQ<2,14>: uq_mul [Primitive]
            │           │       │       ├── UQ<1,7>: mantissa_add_implicit_bit [Composite]
            │           │       │       │   └── UQ<7,0>: Tuple_get_item_1 [Op]
            │           │       │       │       └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │           │       │       │           └── BFloat<16>: a_3 [Var]
            │           │       │       └── UQ<1,7>: mantissa_add_implicit_bit [Composite]
            │           │       │           └── UQ<7,0>: Tuple_get_item_1 [Op]
            │           │       │               └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │           │       │                   └── BFloat<16>: b_3 [Var]
            │           │       └── UQ<10,0>: uq_sub [Primitive]
            │           │           ├── UQ<9,0>: uq_max [Primitive]
            │           │           │   ├── UQ<9,0>: uq_max [Primitive]
            │           │           │   │   ├── UQ<9,0>: uq_add [Primitive]
            │           │           │   │   │   ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │           │           │   │   │   │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │           │           │   │   │   │       └── BFloat<16>: a_0 [Var]
            │           │           │   │   │   └── UQ<8,0>: Tuple_get_item_2 [Op]
            │           │           │   │   │       └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │           │           │   │   │           └── BFloat<16>: b_0 [Var]
            │           │           │   │   └── UQ<9,0>: uq_add [Primitive]
            │           │           │   │       ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │           │           │   │       │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │           │           │   │       │       └── BFloat<16>: a_1 [Var]
            │           │           │   │       └── UQ<8,0>: Tuple_get_item_2 [Op]
            │           │           │   │           └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │           │           │   │               └── BFloat<16>: b_1 [Var]
            │           │           │   └── UQ<9,0>: uq_max [Primitive]
            │           │           │       ├── UQ<9,0>: uq_add [Primitive]
            │           │           │       │   ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │           │           │       │   │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │           │           │       │   │       └── BFloat<16>: a_2 [Var]
            │           │           │       │   └── UQ<8,0>: Tuple_get_item_2 [Op]
            │           │           │       │       └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │           │           │       │           └── BFloat<16>: b_2 [Var]
            │           │           │       └── UQ<9,0>: uq_add [Primitive]
            │           │           │           ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │           │           │           │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │           │           │           │       └── BFloat<16>: a_3 [Var]
            │           │           │           └── UQ<8,0>: Tuple_get_item_2 [Op]
            │           │           │               └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │           │           │                   └── BFloat<16>: b_3 [Var]
            │           │           └── UQ<9,0>: uq_add [Primitive]
            │           │               ├── UQ<8,0>: Tuple_get_item_2 [Op]
            │           │               │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │           │               │       └── BFloat<16>: a_3 [Var]
            │           │               └── UQ<8,0>: Tuple_get_item_2 [Op]
            │           │                   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │           │                       └── BFloat<16>: b_3 [Var]
            │           └── UQ<1,0>: sign_xor [Primitive]
            │               ├── UQ<1,0>: Tuple_get_item_0 [Op]
            │               │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │               │       └── BFloat<16>: a_3 [Var]
            │               └── UQ<1,0>: Tuple_get_item_0 [Op]
            │                   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
            │                       └── BFloat<16>: b_3 [Var]
            └── Q<11,0>: q_sub [Primitive]
                ├── Q<10,0>: uq_to_q [Primitive]
                │   └── UQ<9,0>: uq_max [Primitive]
                │       ├── UQ<9,0>: uq_max [Primitive]
                │       │   ├── UQ<9,0>: uq_add [Primitive]
                │       │   │   ├── UQ<8,0>: Tuple_get_item_2 [Op]
                │       │   │   │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
                │       │   │   │       └── BFloat<16>: a_0 [Var]
                │       │   │   └── UQ<8,0>: Tuple_get_item_2 [Op]
                │       │   │       └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
                │       │   │           └── BFloat<16>: b_0 [Var]
                │       │   └── UQ<9,0>: uq_add [Primitive]
                │       │       ├── UQ<8,0>: Tuple_get_item_2 [Op]
                │       │       │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
                │       │       │       └── BFloat<16>: a_1 [Var]
                │       │       └── UQ<8,0>: Tuple_get_item_2 [Op]
                │       │           └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
                │       │               └── BFloat<16>: b_1 [Var]
                │       └── UQ<9,0>: uq_max [Primitive]
                │           ├── UQ<9,0>: uq_add [Primitive]
                │           │   ├── UQ<8,0>: Tuple_get_item_2 [Op]
                │           │   │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
                │           │   │       └── BFloat<16>: a_2 [Var]
                │           │   └── UQ<8,0>: Tuple_get_item_2 [Op]
                │           │       └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
                │           │           └── BFloat<16>: b_2 [Var]
                │           └── UQ<9,0>: uq_add [Primitive]
                │               ├── UQ<8,0>: Tuple_get_item_2 [Op]
                │               │   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
                │               │       └── BFloat<16>: a_3 [Var]
                │               └── UQ<8,0>: Tuple_get_item_2 [Op]
                │                   └── Tuple<UQ<1,0>, UQ<7,0>, UQ<8,0>>: bf16_decode [Primitive]
                │                       └── BFloat<16>: b_3 [Var]
                └── Q<8,0>: BFloat16.exponent_bias [Const]

```
